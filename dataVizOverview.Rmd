
---
title: "Data Visualization"
author: "Jared E. Knowles"
date: "February 25, 2016"
output: 
  ioslides_presentation:
    css: custom.css
    widescreen: TRUE
runtime: shiny
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(ggplot2)
library(scales)
```

## Data Visualization

- Data use is increasingly popular in many areas (including education)
- Policymakers are under increasing pressure to use data to inform decisions, 
justify funding, and guide practice
- **But,** policymakers are often **not** statisticians, researchers, or quants
- **Data visualization** is a way to bridge this gap
- Proper data visualization will bring the data to the audience in a way they can understand quickly and use to inform decisions

## A Definition

<p><q>Data visualization is a tool for communicating <span class = 'red'>a 
specific feature</span> of a dataset in an approachable and efficient manner</q></p>


## The Challenge

- Data visualization is a communication tool -- like writing
- Like writing, data visualization is very **audience dependent**
- Like writing, data visualization has **different purposes**
- Like writing, data visualization has **varying styles**
- Like writing, data visualization is **shaped by context and technology**

## Think about writing
- What are some different ways you use writing in your day to day life?

>- Note taking
>- Explanation
>- Sharing
>- Thinking
>- Persuading

<p><q>If a picture is worth a thousand words, a good data visualization must 
always be <span class = 'red'>better than a table.</span></q></p>


## Objectives

1. Deconstruct the components of data visualization
2. Apply this to a complex data visualization
3. Review data visualization examples
4. Discuss the role of context
5. Leveraging Visualization


## Deconstructing a graphic

```{r}
data(tips, package = "reshape2")

ggplot(tips, aes(x = total_bill, y = tip, color = time)) + 
  geom_point() + geom_smooth(aes(group = 1), se = FALSE, 
                             show.legend = FALSE) + 
  scale_color_brewer(type = "qual", palette = 2) + 
  labs(x="Total Bill ($)", y="Tip ($)", 
       title="Restaurant Tipping Patterns", color = "Meal") + 
  scale_y_continuous(label = dollar) + scale_x_continuous(label = dollar) +
  theme_classic()

```


## Elements 
<div class="col2">

- Aesthetics
- Geometry
- Guides
- Scales
- Labels
- Layers


```{r plot1,out.width="500px",out.height="360px",echo=FALSE}
ggplot(tips, aes(x = total_bill, y = tip, color = time)) + 
  geom_point() + geom_smooth(aes(group = 1), se = FALSE, 
                             show.legend = FALSE) + 
  scale_color_brewer(type = "qual", palette = 2) + 
  labs(x="Total Bill ($)", y="Tip ($)", 
       title="Restaurant Tipping Patterns", color = "Meal") + 
  scale_y_continuous(label = dollar) + scale_x_continuous(label = dollar) +
  theme_classic()
```
</div>

## Aesthetics

Aesthetics are the visual elements we use to encode data onto a plot. Examples 
include: 

- Location (x and y coordinates)
- Color and Fill
- Size and Shape
- Alpha / transparency

## Experiment with Aesthetics

```{r aesthetics}
inputPanel(
  selectInput("x", label = "X axis:",
      choices = c("total_bill", "tip", "sex", "smoker", 
                  "day", "time", "size"), selected = "total_bill"),
  selectInput("y", label = "Y axis:",
      choices = c("total_bill", "tip", "sex", "smoker", 
                  "day", "time", "size"), selected = "tip"),
  selectInput("color", label = "Color:",
      choices = c("total_bill", "tip", "sex", "smoker", 
                  "day", "time", "size"), selected = "sex")
)

renderPlot({
  ggplot(tips, aes_string(x = input$x, y = input$y, color = input$color)) + 
  geom_point() +
  scale_color_brewer(type = "qual", palette = 2) + 
  labs(title="Restaurant Tipping Patterns") + 
  theme_classic()
})
```

## Geometries

Geometries are visual elements themselves -- objects that are placed on the canvas

- point
- line
- polygon
- boxplot
- text

When you think of differences in chart types (bar, pie, etc.) you are most often 
thinking of different ways they arrange geometries. 

## Experiment with Geometries


```{r geometries}

shinyApp(
   ui = fluidPage(
  sidebarLayout(
    sidebarPanel(
  selectInput("x", label = "X axis:",
      choices = c("total_bill", "tip", "sex", "smoker", 
                  "day", "time", "size"), selected = "total_bill"),
  selectInput("y", label = "Y axis:",
      choices = c("total_bill", "tip", "sex", "smoker", 
                  "day", "time", "size"), selected = "tip"),
  selectInput("color", label = "Color:",
      choices = c("total_bill", "tip", "sex", "smoker", 
                  "day", "time", "size"), selected = "sex"), 
  selectInput("geom", label = "Geometry:",
      choices = c("point", "text", "bar", "line", "smoother",
                  "boxplot", "contour", "bin", "violin"), selected = "point"), 
  width = 2), 
    mainPanel(plotOutput("geomPlot")
    )
  )),
  
  server = function(input, output) {
    p1 <- reactive({
     ggplot(tips, aes_string(x = input$x, y = input$y, 
                               color = input$color, group = input$color, 
                               fill = input$color)) + 
  scale_color_brewer(type = "qual", palette = 2) + 
  labs(title="Restaurant Tipping Patterns") + 
  theme_classic()
  })
  output$geomPlot <- renderPlot({
 if(input$geom == "point"){
   p1() + geom_point()
 } else if(input$geom == "text"){
   p1() + geom_text(aes_string(label = input$color))
 } else if(input$geom == "bar"){
   p1() + geom_bar(stat = "identity")
 } else if(input$geom == "line"){
  p1() + geom_line() 
 } else if(input$geom == "smoother"){
   p1() + geom_smooth()
 } else if(input$geom == "boxplot"){
   p1() + geom_boxplot()
 } else if(input$geom == "contour"){
   p1() + geom_density_2d()
 } else if(input$geom == "bin"){
   p1() + geom_bin2d()
 } else if(input$geom == "violin"){
   p1() + geom_violin()
 }}, width=600 , height=500)
    })


```


## Guides

A guide is an element that helps the user map visual cues to data points. Legends 
are the most common type of guide. 

- Axes
- Reference lines
- Color bars
- Annotations

## Experiment with Guides

```{r guides}
shinyApp(
   ui = fluidPage(
  sidebarLayout(
    sidebarPanel(
  selectInput("x", label = "X axis:",
      choices = c("total_bill", "tip", "size"), selected = "total_bill"),
  selectInput("y", label = "Y axis:",
      choices = c("total_bill", "tip", "size"), selected = "tip"),
  selectInput("guide", label = "Guides:",
      choices = c("axes", "ref. lines", "annotate", "color bar"), 
      selected = "color bar"), 
  width = 2), 
    mainPanel(plotOutput("guidePlot")
    )
  )),
  
  server = function(input, output) {
    p1 <- reactive({
     ggplot(tips, aes_string(x = input$x, y = input$y, 
                               color = "size", 
                               fill = "size")) + 
  geom_point() + guides(color = "none", fill = "none") +
  labs(title="Restaurant Tipping Patterns") + 
  theme_classic()
  })
  output$guidePlot <- renderPlot({
 if(input$guide == "axes"){
   p1() + theme(axis.line = element_blank(),
                  axis.text = element_blank(), axis.ticks = element_blank())
 } else if(input$guide == "ref. lines"){
   p1() + 
     theme(panel.grid = element_line(color = "gray50", size = 0.5, linetype = 3),
           panel.grid.major = element_line(), panel.grid.minor = element_line())
 } else if(input$guide == "annotate"){
   p1() + annotate("text", x = 7, y = 7, label = "Annotation") + 
     annotate("text", x = 7, y = 4, label = "Look here!")
 } else if(input$guide == "color bar"){
  p1() + guides(color = guide_colorbar())
 }}, width=600 , height=500)
    })


```


## Scales

Scales are mathematical transformations of the mapping between data elements and 
aesthetics

- Axis breaks
- Color mapping to data elements
- Transformations like log, square root, etc.

## Experiment with Scales

```{r scales}
shinyApp(
   ui = fluidPage(
  sidebarLayout(
    sidebarPanel(
  selectInput("scale", label = "Scale:",
      choices = c("normal", "breaks", "color-1", "color-2", "sqrt-trans", 
                  "log-trans"), 
      selected = "normal"), 
  width = 2), 
    mainPanel(plotOutput("scalePlot")
    )
  )),
  
  server = function(input, output) {
    p1 <- reactive({
     ggplot(tips, aes_string(x = "total_bill", y = "tip", 
                                color = "size", 
                                fill = "size")) + 
  geom_point() + guides(color = "none", fill = "none") +
  labs(title="Restaurant Tipping Patterns", x= "Total Bill", y = "Tip") +
  scale_y_continuous(label = dollar) + scale_x_continuous(label = dollar) +
  theme_classic()
  })
  output$scalePlot <- renderPlot({
 if(input$scale == "breaks"){
   p1() + scale_y_continuous(breaks = c(1, 5, 12, 25), 
                             label = dollar, limits = c(0, 50)) + 
     scale_x_continuous(breaks = c(0, 30, 32, 36, 42, 48), label = dollar, 
                        limits = c(0, 50))
 } else if(input$scale == "normal"){
   p1() 
 } else if(input$scale == "color-1"){
   p1() + guides(color = guide_colorbar())
 } else if(input$scale == "color-2"){
  p1() + scale_color_gradient(low = "skyblue", high = "dark green") + 
     guides(color = guide_colorbar())
 } else if(input$scale == "sqrt-trans"){
   p1() + scale_y_sqrt(label = dollar) + scale_x_sqrt(label = dollar)
 } else if(input$scale == "log-trans"){
   p1() + scale_y_log10(label = dollar) + scale_x_log10(label = dollar)
 }
    }, width=600 , height=500)
    })


```


## Labels

Labels are additional information that does not directly come from the data 
that helps the user interpret the graph. 

- Titles
- Axis labels
- Legend titles
- Units labels

## Layers

Layers are how all of these elements are pulled together. A layer consists of 
data, a mapping of aesthetics to that data, a geometry to place that data on the 
canvas, and additional parameters to control the scales, labels, and guides. 


## Assembling a Graphic
<div class="col2">

- SCALE: Y (0 - 10), label dollar, data = Tip
- SCALE: X (0 - 50), label dollar, data = Total Bill
- SCALE: Color (Teal = Dinner, Orange = Lunch), data = Meal
- GEOM: Point (x = Total Bill, y = Tip, color = MEAL)
- GEOM: Line (x = Total Bill, y = Tip)





```{r plotHalf, out.width="500px",out.height="360px",echo=FALSE}
ggplot(tips, aes(x = total_bill, y = tip, color = time)) + 
  geom_point() + geom_smooth(aes(group = 1), se = FALSE, 
                             show.legend = FALSE) + 
  scale_color_brewer(type = "qual", palette = 2) + 
  labs(x="Total Bill ($)", y="Tip ($)", 
       title="Restaurant Tipping Patterns", color = "Meal") + 
  scale_y_continuous(label = dollar) + scale_x_continuous(label = dollar) +
  theme_classic()
```
</div>

## Context

2. Apply this to a complex data visualization


## Leveraging Visualization Skills

1. Using data to visualize and not storytell
2. Review persuasive techniques
3. Discuss role of visualization
4. Closing an argument

## Why focus on persuasion?

- Most data presentations seek to make some sort of an argument
- Goal is to convince someone to make a decision or to understand a problem 
that requires their attention
- The evidence provided is in the form of data
- But the goal is to spur some action (concern, policy change, attention shift, etc.)

## Why not storytelling?

- Storytelling allows the construction of a compelling narrative, but data, evidence, 
and facts are not necessary
- Storytelling invites alternative explanations with no way to equate them
- Storytelling implies an ending/resolution and does not require the audience to 
contribute
- Audiences can choose to ignore, dislike, disregard stories

## How is persuasion different?

An argument has three classic components:

1. A claim
2. Evidence
3. A warrant

This can be extended by explicitly anticipating and rebutting counter claims:

4. Acknowledge counterclaim
5. Offer rebuttal (1-3)

## Types of Claims

- Claims of fact
- Claims of value
- Claims of policy

## Types of evidence

- Sufficient and appropriate data
- Credibility and reputation
- Appeal to authority

## Logic and causality

- Sequencing
- Discussion of plausible mediators
- Rejection of counter-claims

## Policy claims

- Require a mix of both fact and values
  - "Does this outcome fit with our values as an organization?"
- Need to directly address trade offs of alternatives, most importantly status 
quo

## Warrants

Warrants are assumptions that underpin the evidence. This is especially crucial 
in using data as evidence. 

- Do you have a shared understanding of the meaning of the data elements?
- Is there shared trust about the validity/accuracy of the measures?
- Are the definitions embodied in the data meaningful and shared?

The key here is to know your audience.

## 




3. Review data visualization examples
4. Discuss the role of context
5. Leveraging Visualization

